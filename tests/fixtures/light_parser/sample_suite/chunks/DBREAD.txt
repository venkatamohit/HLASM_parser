DBREAD   IN
         STM   R14,R12,12(R13)
         BALR  R12,0
         USING *,R12
         ST    R13,DBRSAVE+4
         LA    R13,DBRSAVE
*
* ---- Verify file is open -------------------------------------
         TM    MSTFILE+48,X'10'   Check VSAM ACB open flag
         BZ    DBRNOTOP           File not open
*
* ---- Issue VSAM GET (keyed direct) --------------------------
         GET   RPL=DBRPL          Retrieve by key
         LTR   R15,R15
         BNZ   DBRNFND            Check for not-found vs I/O error
*
* ---- Record found – copy to caller's layout -----------------
         MVC   MSTNAME, MSTREC+8(30)    Name field
         MVC   MSTDEPT, MSTREC+38(4)    Department
         MVC   MSTGRD,  MSTREC+42(2)    Grade
         MVC   MSTTYP,  MSTREC+44(1)    Employment type
         ZAP   MSTSAL,  MSTREC+45       Annual salary
         MVC   MSTHIRDT,MSTREC+53(8)    Hire date
         MVC   MSTTRMDT,MSTREC+61(8)    Termination date (or spaces)
         MVI   DBRSTATS,C'F'      Status = Found
         XR    R15,R15            Return 0 = success
         B     DBREXIT
*
* ---- Record not found ----------------------------------------
DBRNFND  DS    0H
         C     R15,=F'8'          Is it a logical error (not found)?
         BNE   DBIOERR            No – real I/O error
         MVI   DBRSTATS,C'N'      Status = Not found
         MVC   DBERR,=CL40'Employee record not in master file '
         LA    R15,4              Return code 4 = not found
         B     DBREXIT
*
* ---- I/O error ----------------------------------------------
DBIOERR  DS    0H
         MVI   DBRSTATS,C'E'      Status = Error
         MVC   DBERR,=CL40'VSAM I/O error reading master file '
         LA    R15,8
         B     DBREXIT
*
* ---- File not open ------------------------------------------
DBRNOTOP DS    0H
         MVI   DBRSTATS,C'C'      Status = Closed
         MVC   DBERR,=CL40'EMPMAST file is not open           '
         LA    R15,12
*
* ---- Exit ---------------------------------------------------
DBREXIT  DS    0H
         L     R13,DBRSAVE+4
         LM    R14,R12,12(R13)    Restore registers; R15 already set
         BR    R14
         OUT
